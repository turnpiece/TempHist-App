# ios/fastlane/Fastfile

default_platform(:ios)

platform :ios do
    desc "Build and upload to TestFlight"
    lane :beta do
      api_key = app_store_connect_api_key(
        key_id: ENV['APP_STORE_KEY_ID'],
        issuer_id: ENV['APP_STORE_ISSUER_ID'],
        key_content: ENV['APP_STORE_PRIVATE_KEY'],
        in_house: false
      )
  
      build_app(
        scheme: "Runner",
        export_method: "app-store", # uses distribution provisioning
        export_options: {
          provisioningProfiles: {
            ENV["APP_IDENTIFIER"] => "match AppStore #{ENV["APP_IDENTIFIER"]}"
          }
        }
      )
  
      upload_to_testflight(
        api_key: api_key,
        app_identifier: ENV['APP_IDENTIFIER'],
        team_id: ENV['APP_STORE_TEAM_ID']
      )
    end
end